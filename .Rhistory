) +
labs(
title = "NEK Broadband fiber service",
subtitle = "By Census block",
x = NULL,
y = NULL,
caption = "Data source: FCC Form 477\nMap source: © OpenStreetMap contributors © CARTO",
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_broadband_fiber_service.png"), chart_height = 8.25)
fig <- ggplot(data = nek_service_blocks) +
base_map(
st_bbox(nek_service_blocks),
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_fiber), color = "black", linewidth = 0, alpha = .9) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = TRUE
) +
theme_cori_map() +
theme(
legend.key.width = unit(40, "pt")
) +
labs(
title = "NEK Broadband fiber service",
subtitle = "By Census block",
x = NULL,
y = NULL,
caption = "Data source: FCC Form 477\nMap source: © OpenStreetMap contributors © CARTO",
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_broadband_fiber_service.png"), chart_height = 8.25)
fig <- ggplot(data = nek_service_blocks) +
base_map(
st_bbox(nek_service_blocks),
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_fiber), color = "black", linewidth = 0, alpha = .7) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = TRUE
) +
theme_cori_map() +
theme(
legend.key.width = unit(40, "pt")
) +
labs(
title = "NEK Broadband fiber service",
subtitle = "By Census block",
x = NULL,
y = NULL,
caption = "Data source: FCC Form 477\nMap source: © OpenStreetMap contributors © CARTO",
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_broadband_fiber_service.png"), chart_height = 8.25)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_broadband_fiber_service.png"), chart_height = 9)
library(cori.data.fcc)
library(dplyr)
library(sf)
library(ggplot2)
library(cori.charts)
library(basemapR)
library(here)
cori.charts::load_fonts()
i_am("posts/cori_data_fcc_overview/index.qmd")
caledonia_co_nbm <- get_nbm_bl(geoid_co = "50005")
essex_co_nbm <- get_nbm_bl(geoid_co = "50009")
orleans_co_nbm <- get_nbm_bl(geoid_co = "50019")
nek_nbm <- bind_rows(
caledonia_co_nbm,
essex_co_nbm,
orleans_co_nbm
)
glimpse(nek_nbm)
# Load all Vermont Census blocks
vt_blocks <- tigris::blocks("VT", progress_bar = FALSE)
# Load the Place boundary for the town of St. Johnsbury, VT
vt_places <- tigris::places(state = "VT", progress_bar = FALSE)
stj_vt <- vt_places %>% filter(GEOID == "5062125")
stj_vt_blocks <- vt_blocks %>%
filter(lengths(st_intersects(., stj_vt)) > 0)
stj_vt_bb_blocks <- inner_join(
stj_vt_blocks,
nek_nbm,
by = c("GEOID20" = "geoid_bl")
) %>%
mutate(
pct_100_20 = cnt_100_20 / cnt_total_locations
)
bbox <- st_bbox(stj_vt_bb_blocks) %>%
fit_bbox_to_aspect_ratio(target_aspect_ratio = 2)
fig <- ggplot(data = stj_vt_bb_blocks) +
base_map(
bbox,
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_100_20), color = "dimgray", linewidth = .1, alpha = 0.9) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = T
) +
coord_sf(
expand = TRUE,
xlim = c(bbox['xmin'], bbox['xmax']),
ylim = c(bbox['ymin'], bbox['ymax'])
) +
theme_cori_map() +
theme(
legend.key.width = unit(50, "pt"),
) +
labs(
title = "Broadband service in St. Johnsbury, VT",
subtitle = "Percent of locations with access to 100/20 Mbps service by census block",
caption = "Data source: FCC National Broadband Map\nMap source: © OpenStreetMap contributors © CARTO"
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/st_j_bb_service.png"), chart_height = 8)
# Get Census block BB data for the Northeast Kingdom
nek_bb_blocks <- inner_join(
vt_blocks,
nek_nbm,
by = c("GEOID20" = "geoid_bl")
) %>%
mutate(
pct_100_20 = cnt_100_20 / cnt_total_locations,
pct_fiber = cnt_fiber_locations / cnt_total_locations
)
# Get major NEK Place centroids for map labeling
vt_places_centroids <- vt_places %>%
st_as_sf() %>%
st_centroid() %>%
filter(lengths(st_intersects(., nek_bb_blocks)) > 0)
bbox <- st_bbox(nek_bb_blocks) %>%
fit_bbox_to_aspect_ratio(target_aspect_ratio = 2)
fig <- ggplot(data = nek_bb_blocks) +
base_map(
bbox,
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_100_20), color = "dimgray", linewidth = 0.1, alpha = 0.9) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = T
) +
geom_sf_label(data = vt_places_centroids, aes(label = NAME), size = 2, color = "black", family = "Lato", fontface = "bold") +
coord_sf(
expand = TRUE,
xlim = c(bbox['xmin'], bbox['xmax']),
ylim = c(bbox['ymin'], bbox['ymax'])
) +
theme_cori_map() +
theme(
legend.key.width = unit(50, "pt"),
) +
labs(
title = "Broadband service in the Northeast Kingdom",
subtitle = "Percent of locations with access to 100/20 Mbps service by census block",
caption = "Data source: FCC National Broadband Map\nMap source: © OpenStreetMap contributors © CARTO",
x = NULL,
y = NULL
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_bb_service.png"), chart_height = 8)
fig <- ggplot(data = nek_bb_blocks) +
base_map(
bbox,
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_fiber), color = "dimgray", linewidth = 0.1, alpha = 0.6) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = T
) +
geom_sf_label(data = vt_places_centroids, aes(label = NAME), size = 2, color = "black", family = "Lato", fontface = "bold") +
coord_sf(
expand = TRUE,
xlim = c(bbox['xmin'], bbox['xmax']),
ylim = c(bbox['ymin'], bbox['ymax'])
) +
theme_cori_map() +
theme(
legend.key.width = unit(50, "pt"),
) +
labs(
title = "Fiber access in the Northeast Kingdom",
subtitle = "Percent of locations with access to fiber by census block",
caption = "Data source: FCC National Broadband Map\nMap source: © OpenStreetMap contributors © CARTO",
x = NULL,
y = NULL
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_fiber_service.png"), chart_height = 8)
# Calculate share of locations with access to fiber
nek_locations_total <- nek_bb_blocks %>%
pull(cnt_total_locations) %>%
sum(na.rm = T)
nek_locations_fiber <- nek_bb_blocks %>%
pull(cnt_fiber_locations) %>%
sum(na.rm = T)
nek_locations_fiber / nek_locations_total
vt_477 <- get_f477("VT", frn = "all")
nek_bb_frn <- "0031871197"
nek_service <- vt_477  %>%
filter(FRN == nek_bb_frn) %>%
mutate(
Date = as.character(Date)
)
glimpse(nek_service)
nek_service_blocks <- left_join(
nek_service,
vt_blocks,
by = c("BlockCode" = "GEOID20")
) %>%
left_join(
.,
nek_nbm,
by = c("BlockCode" = "geoid_bl")
) %>%
mutate(
pct_100_20 = cnt_100_20 / cnt_total_locations,
pct_fiber = cnt_fiber_locations / cnt_total_locations
) %>%
sf::st_as_sf()
#
# bbox <- st_bbox(nek_service_blocks) %>%
#       fit_bbox_to_aspect_ratio(target_aspect_ratio = 2)
fig <- ggplot(data = nek_service_blocks) +
base_map(
st_bbox(nek_service_blocks),
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(fill = "black", color = "black", linewidth = 0, alpha = .2) +
theme_cori_map() +
labs(
title = "NEK Broadband service footprint",
subtitle = "By Census block",
x = NULL,
y = NULL,
caption = "Data source: FCC Form 477\nMap source: © OpenStreetMap contributors © CARTO",
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_broadband_footprint.png"), chart_height = 8.25)
fig <- ggplot(data = nek_service_blocks) +
base_map(
st_bbox(nek_service_blocks),
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_fiber), color = "black", linewidth = 0, alpha = .7) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = TRUE
) +
theme_cori_map() +
theme(
legend.key.width = unit(40, "pt")
) +
labs(
title = "NEK Broadband fiber service",
subtitle = "By Census block",
x = NULL,
y = NULL,
caption = "Data source: FCC Form 477\nMap source: © OpenStreetMap contributors © CARTO",
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_broadband_fiber_service.png"), chart_height = 9)
View(nek_service_blocks)
View(nek_service)
View(nek_nbm)
library(cori.data.fcc)
library(dplyr)
library(sf)
library(ggplot2)
library(cori.charts)
library(basemapR)
library(here)
cori.charts::load_fonts()
i_am("posts/cori_data_fcc_overview/index.qmd")
caledonia_co_nbm <- get_nbm_bl(geoid_co = "50005")
essex_co_nbm <- get_nbm_bl(geoid_co = "50009")
orleans_co_nbm <- get_nbm_bl(geoid_co = "50019")
nek_nbm <- bind_rows(
caledonia_co_nbm,
essex_co_nbm,
orleans_co_nbm
)
glimpse(nek_nbm)
# Load all Vermont Census blocks
vt_blocks <- tigris::blocks("VT", progress_bar = FALSE)
# Load the Place boundary for the town of St. Johnsbury, VT
vt_places <- tigris::places(state = "VT", progress_bar = FALSE)
stj_vt <- vt_places %>% filter(GEOID == "5062125")
stj_vt_blocks <- vt_blocks %>%
filter(lengths(st_intersects(., stj_vt)) > 0)
stj_vt_bb_blocks <- inner_join(
stj_vt_blocks,
nek_nbm,
by = c("GEOID20" = "geoid_bl")
) %>%
mutate(
pct_100_20 = cnt_100_20 / cnt_total_locations
)
bbox <- st_bbox(stj_vt_bb_blocks) %>%
fit_bbox_to_aspect_ratio(target_aspect_ratio = 2)
fig <- ggplot(data = stj_vt_bb_blocks) +
base_map(
bbox,
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_100_20), color = "dimgray", linewidth = .1, alpha = 0.9) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = T
) +
coord_sf(
expand = TRUE,
xlim = c(bbox['xmin'], bbox['xmax']),
ylim = c(bbox['ymin'], bbox['ymax'])
) +
theme_cori_map() +
theme(
legend.key.width = unit(50, "pt"),
) +
labs(
title = "Broadband service in St. Johnsbury, VT",
subtitle = "Percent of locations with access to 100/20 Mbps service by census block",
caption = "Data source: 2023 FCC National Broadband Map\nMap source: © OpenStreetMap contributors © CARTO"
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/st_j_bb_service.png"), chart_height = 8)
# Get Census block BB data for the Northeast Kingdom
nek_bb_blocks <- inner_join(
vt_blocks,
nek_nbm,
by = c("GEOID20" = "geoid_bl")
) %>%
mutate(
pct_100_20 = cnt_100_20 / cnt_total_locations,
pct_fiber = cnt_fiber_locations / cnt_total_locations
)
# Get major NEK Place centroids for map labeling
vt_places_centroids <- vt_places %>%
st_as_sf() %>%
st_centroid() %>%
filter(lengths(st_intersects(., nek_bb_blocks)) > 0)
bbox <- st_bbox(nek_bb_blocks) %>%
fit_bbox_to_aspect_ratio(target_aspect_ratio = 2)
fig <- ggplot(data = nek_bb_blocks) +
base_map(
bbox,
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_100_20), color = "dimgray", linewidth = 0.1, alpha = 0.9) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = T
) +
geom_sf_label(data = vt_places_centroids, aes(label = NAME), size = 2, color = "black", family = "Lato", fontface = "bold") +
coord_sf(
expand = TRUE,
xlim = c(bbox['xmin'], bbox['xmax']),
ylim = c(bbox['ymin'], bbox['ymax'])
) +
theme_cori_map() +
theme(
legend.key.width = unit(50, "pt"),
) +
labs(
title = "Broadband service in the Northeast Kingdom",
subtitle = "Percent of locations with access to 100/20 Mbps service by census block",
caption = "Data source: 2023 FCC National Broadband Map\nMap source: © OpenStreetMap contributors © CARTO",
x = NULL,
y = NULL
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_bb_service.png"), chart_height = 8)
fig <- ggplot(data = nek_bb_blocks) +
base_map(
bbox,
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_fiber), color = "dimgray", linewidth = 0.1, alpha = 0.6) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = T
) +
geom_sf_label(data = vt_places_centroids, aes(label = NAME), size = 2, color = "black", family = "Lato", fontface = "bold") +
coord_sf(
expand = TRUE,
xlim = c(bbox['xmin'], bbox['xmax']),
ylim = c(bbox['ymin'], bbox['ymax'])
) +
theme_cori_map() +
theme(
legend.key.width = unit(50, "pt"),
) +
labs(
title = "Fiber access in the Northeast Kingdom",
subtitle = "Percent of locations with access to fiber by census block",
caption = "Data source: 2023 FCC National Broadband Map\nMap source: © OpenStreetMap contributors © CARTO",
x = NULL,
y = NULL
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_fiber_service.png"), chart_height = 8)
# Calculate share of locations with access to fiber
nek_locations_total <- nek_bb_blocks %>%
pull(cnt_total_locations) %>%
sum(na.rm = T)
nek_locations_fiber <- nek_bb_blocks %>%
pull(cnt_fiber_locations) %>%
sum(na.rm = T)
nek_locations_fiber / nek_locations_total
vt_477 <- get_f477("VT", frn = "all")
nek_bb_frn <- "0031871197"
nek_service <- vt_477  %>%
filter(FRN == nek_bb_frn) %>%
mutate(
Date = as.character(Date)
)
glimpse(nek_service)
nek_service_blocks <- left_join(
nek_service,
vt_blocks,
by = c("BlockCode" = "GEOID20")
) %>%
left_join(
.,
nek_nbm,
by = c("BlockCode" = "geoid_bl")
) %>%
mutate(
pct_100_20 = cnt_100_20 / cnt_total_locations,
pct_fiber = cnt_fiber_locations / cnt_total_locations
) %>%
sf::st_as_sf()
#
# bbox <- st_bbox(nek_service_blocks) %>%
#       fit_bbox_to_aspect_ratio(target_aspect_ratio = 2)
fig <- ggplot(data = nek_service_blocks) +
base_map(
st_bbox(nek_service_blocks),
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(fill = "black", color = "black", linewidth = 0, alpha = .2) +
theme_cori_map() +
labs(
title = "NEK Broadband service footprint",
subtitle = "By Census block",
x = NULL,
y = NULL,
caption = "Data source: 2021 FCC Form 477\nMap source: © OpenStreetMap contributors © CARTO",
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_broadband_footprint.png"), chart_height = 8.25)
fig <- ggplot(data = nek_service_blocks) +
base_map(
st_bbox(nek_service_blocks),
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_fiber), color = "black", linewidth = 0, alpha = .7) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = TRUE
) +
theme_cori_map() +
theme(
legend.key.width = unit(40, "pt")
) +
labs(
title = "NEK Broadband fiber service",
subtitle = "By Census block",
x = NULL,
y = NULL,
caption = "Data source: 2021 FCC Form 477\nMap source: © OpenStreetMap contributors © CARTO",
)
save_plot(fig, here("posts/cori_data_fcc_overview/images/nek_broadband_fiber_service.png"), chart_height = 9)
View(nek_nbm)
?get_nbm_bl
get_nbm_release(
filing_url = "https://broadbandmap.fcc.gov/nbm/map/api/published/filing",
user_agent = the$user_agent
)
test <- get_nbm_release(
filing_url = "https://broadbandmap.fcc.gov/nbm/map/api/published/filing",
user_agent = the$user_agent
)
View(test)
get_nbm_release()
get_nbm_available()
test <- get_county_nbm_raw("33009", frn = "all", release = "2023-12-01")
View(test)
