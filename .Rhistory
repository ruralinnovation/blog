save_plot(fig, here("posts/10_cori_data_fcc_overview/images/nek_broadband_footprint.png"), chart_height = 8.25)
fig <- ggplot(data = nek_service_blocks) +
base_map(
st_bbox(nek_service_blocks),
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_fiber), color = "black", linewidth = 0, alpha = .7) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = TRUE
) +
theme_cori_map() +
theme(
legend.key.width = unit(40, "pt")
) +
labs(
title = "NEK Broadband fiber service",
subtitle = "By Census block",
x = NULL,
y = NULL,
caption = "Data source: 2021 FCC Form 477\nMap source: © OpenStreetMap contributors © CARTO",
)
save_plot(fig, here("posts/10_cori_data_fcc_overview/images/nek_broadband_fiber_service.png"), chart_height = 9)
# See what NBM releases are available
available_releases <- get_nbm_release()
caledonia_2023 <- get_county_nbm_raw("50005", frn = "all", release = "2023-12-01") %>%
mutate(year = 2023)
caledonia_2022 <- get_county_nbm_raw("50005", frn = "all", release = "2022-12-01") %>%
mutate(year = 2022)
caledonia_combined <- bind_rows(
caledonia_2022,
caledonia_2023
)
# Calculate the percent of locations with at least 100/20 Mbps service
caledonia_chg <- caledonia_combined %>%
mutate(
has_100_20_service = ifelse(
max_advertised_download_speed >= 100 &
max_advertised_upload_speed >= 20,
1,
0
)) %>%
mutate(
valid_100_20_location = ifelse(has_100_20_service == 1, location_id, NA)
) %>%
# Filter out satellite coverage which overstates service levels
dplyr::filter(!technology %in% c("61", "60")) %>%
group_by(geoid_bl, year) %>%
summarise(
# number of locations that have 100/20 service
count_100_20 = n_distinct(valid_100_20_location, na.rm = TRUE),
# number of location
count_total = n_distinct(location_id),
# number of services
n_services = n()
) %>%
mutate(
pct_100_20 = count_100_20 / count_total
) %>%
select(geoid_bl, count_100_20, count_total, n_services, pct_100_20, year)
# Combine with tigris spatial data to get our data ready for mapping
caledonia_blocks <- tigris::blocks("50", county = "005")
chrt_dta <- left_join(
caledonia_blocks,
caledonia_chg,
by = c("GEOID20" = "geoid_bl")
) %>%
filter(!is.na(year))
fig <- ggplot(data = chrt_dta) +
base_map(
st_bbox(chrt_dta),
increase_zoom = 3,
basemap = 'voyager'
) +
geom_sf(aes(fill = pct_100_20), color = "black", linewidth = .05, alpha = .7) +
scale_fill_cori(
discrete = FALSE,
palette = "ctg2pu",
labels = scales::label_percent(),
reverse = TRUE
) +
theme_cori_map() +
theme(
legend.key.width = unit(40, "pt"),
strip.text = element_text(face = "bold", size = 12)
) +
labs(
title = "Caledonia County broaband service over time",
subtitle = "Percent of locations with 100/20 Mbps broadband service, by Census block",
x = NULL,
y = NULL,
caption = "Data source: 2022 and 2023 FCC NBM\nMap source: © OpenStreetMap contributors © CARTO",
) +
facet_wrap(~year, ncol = 2)
save_plot(fig, here("posts/10_cori_data_fcc_overview/images/caledonia_broadband_100_20_service.png"), chart_height = 8.5)
quarto preview
library(dplyr)
library(tidyr)
library(here)
library(readr)
i_am("posts/14_nonmetro_to_metro/analysis.qmd")
?tigris::tracts
# install.packages("devtools")
devtools::install_github("ruralinnovation/ruraldefinitions")
rucc_1983 <-ruraldefinitions::rucc_1983
library(dplyr)
library(tidyr)
library(here)
library(readr)
i_am("posts/14_nonmetro_to_metro/analysis.qmd")
rucc_1974 <- ruraldefinitions::rucc_1974
rucc_1983 <- ruraldefinitions::rucc_1983
rucc_1993 <- ruraldefinitions::rucc_1993
rucc_2003 <- ruraldefinitions::rucc_2003
rucc_2013 <- ruraldefinitions::rucc_2013
rucc_2023 <- ruraldefinitions::rucc_2023
View(rucc_2023)
rucc_1974 <- ruraldefinitions::rucc_1974
rucc_1983 <- ruraldefinitions::rucc_1983
rucc_1993 <- ruraldefinitions::rucc_1993
rucc_2003 <- ruraldefinitions::rucc_2003
rucc_2013 <- ruraldefinitions::rucc_2013
rucc_2023 <- ruraldefinitions::rucc_2023
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
)
rucc_1974 <- ruraldefinitions::rucc_1974 %>%
mutate(rural_def = as.character(rural_def))
library(dplyr)
library(tidyr)
library(here)
library(readr)
i_am("posts/14_nonmetro_to_metro/analysis.qmd")
rucc_1974 <- ruraldefinitions::rucc_1974 %>%
mutate(rural_def = as.character(rural_def))
rucc_1983 <- ruraldefinitions::rucc_1983 %>%
mutate(rural_def = as.character(rural_def))
rucc_1993 <- ruraldefinitions::rucc_1993 %>%
mutate(rural_def = as.character(rural_def))
rucc_2003 <- ruraldefinitions::rucc_2003 %>%
mutate(rural_def = as.character(rural_def))
rucc_2013 <- ruraldefinitions::rucc_2013 %>%
mutate(rural_def = as.character(rural_def))
rucc_2023 <- ruraldefinitions::rucc_2023 %>%
mutate(rural_def = as.character(rural_def))
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
)
View(rucc_all)
?tidyr::pivot_wider
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
pivot_wider(
names_from = c("name", "year"),
values_from = "is_rural"
)
View(rucc_all)
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
pivot_wider(
names_from = c("year"),
values_from = "is_rural"
)
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
pivot_wider(
names_from = "year",
values_from = "is_rural"
)
View(rucc_all)
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
select(-rural_def) %>%
pivot_wider(
names_from = "year",
values_from = "is_rural"
)
View(rucc_all)
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
select(-rural_def) %>%
pivot_wider(
names_from = "year",
names_prefix = "rucc_",
values_from = "is_rural"
)
View(rucc_all)
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
select(-rural_def) %>%
pivot_wider(
names_from = "year",
names_prefix = "rucc_",
values_from = "is_rural"
) %>%
filter(rucc_1974 !== rucc_2023)
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
select(-rural_def) %>%
pivot_wider(
names_from = "year",
names_prefix = "rucc_",
values_from = "is_rural"
) %>%
filter(rucc_1974 != rucc_2023)
View(rucc_all)
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
select(-rural_def) %>%
pivot_wider(
names_from = "year",
names_prefix = "rucc_",
values_from = "is_rural"
) %>%
mutate(
rural_to_nonrural = ifelse(
rucc_1974 == "Rural" & rucc_1983 == "Nonrural",
1983,
ifelse(
rucc_1974 == "Rural" & rucc_1993 == "Nonrural",
1993,
ifelse(
rucc_1974 == "Rural" & rucc_2003 == "Nonrural",
2003,
ifelse(
rucc_1974 == "Rural" & rucc_2013 == "Nonrural",
2013,
ifelse(
rucc_1974 == "Rural" & rucc_2023 == "Nonrural",
2023,
NA
)
)
)
)
)
)
View(rucc_all)
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
select(-rural_def) %>%
pivot_wider(
names_from = "year",
names_prefix = "rucc_",
values_from = "is_rural"
) %>%
mutate(
rural_to_nonrural = ifelse(
rucc_1974 == "Rural" & rucc_1983 == "Nonrural",
1983,
ifelse(
rucc_1974 == "Rural" & rucc_1993 == "Nonrural",
1993,
ifelse(
rucc_1974 == "Rural" & rucc_2003 == "Nonrural",
2003,
ifelse(
rucc_1974 == "Rural" & rucc_2013 == "Nonrural",
2013,
ifelse(
rucc_1974 == "Rural" & rucc_2023 == "Nonrural",
2023,
NA
)
)
)
)
),
nonrural_to_rural = ifelse(
rucc_1974 == "Nonrural" & rucc_1983 == "Rural",
1983,
ifelse(
rucc_1974 == "Nonrural" & rucc_1993 == "Rural",
1993,
ifelse(
rucc_1974 == "Nonrural" & rucc_2003 == "Rural",
2003,
ifelse(
rucc_1974 == "Nonrural" & rucc_2013 == "Rural",
2013,
ifelse(
rucc_1974 == "Nonrural" & rucc_2023 == "Rural",
2023,
NA
)
)
)
)
)
)
View(rucc_all)
readr::write_csv(here("posts/14_nonmetro_to_metro/data/rucc_over_time.csv"))
readr::write_csv(rucc_all, here("posts/14_nonmetro_to_metro/data/rucc_over_time.csv"))
library(coriverse)
library(coriverse)
cori.utils::county_state_crosswalk
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
left_join(
.,
cori.utils::county_state_crosswalk,
by = c("geoid" = "geoid_co")
) %>%
select(-rural_def) %>%
pivot_wider(
names_from = "year",
names_prefix = "rucc_",
values_from = "is_rural"
) %>%
mutate(
rural_to_nonrural = ifelse(
rucc_1974 == "Rural" & rucc_1983 == "Nonrural",
1983,
ifelse(
rucc_1974 == "Rural" & rucc_1993 == "Nonrural",
1993,
ifelse(
rucc_1974 == "Rural" & rucc_2003 == "Nonrural",
2003,
ifelse(
rucc_1974 == "Rural" & rucc_2013 == "Nonrural",
2013,
ifelse(
rucc_1974 == "Rural" & rucc_2023 == "Nonrural",
2023,
NA
)
)
)
)
),
nonrural_to_rural = ifelse(
rucc_1974 == "Nonrural" & rucc_1983 == "Rural",
1983,
ifelse(
rucc_1974 == "Nonrural" & rucc_1993 == "Rural",
1993,
ifelse(
rucc_1974 == "Nonrural" & rucc_2003 == "Rural",
2003,
ifelse(
rucc_1974 == "Nonrural" & rucc_2013 == "Rural",
2013,
ifelse(
rucc_1974 == "Nonrural" & rucc_2023 == "Rural",
2023,
NA
)
)
)
)
)
)
View(rucc_all)
readr::write_csv(rucc_all, here("posts/14_nonmetro_to_metro/data/rucc_over_time.csv"))
library(dplyr)
library(tidyr)
library(here)
library(readr)
library(coriverse)
i_am("posts/14_nonmetro_to_metro/analysis.qmd")
rucc_1974 <- ruraldefinitions::rucc_1974 %>%
mutate(rural_def = as.character(rural_def))
rucc_1983 <- ruraldefinitions::rucc_1983 %>%
mutate(rural_def = as.character(rural_def))
rucc_1993 <- ruraldefinitions::rucc_1993 %>%
mutate(rural_def = as.character(rural_def))
rucc_2003 <- ruraldefinitions::rucc_2003 %>%
mutate(rural_def = as.character(rural_def))
rucc_2013 <- ruraldefinitions::rucc_2013 %>%
mutate(rural_def = as.character(rural_def))
rucc_2023 <- ruraldefinitions::rucc_2023 %>%
mutate(rural_def = as.character(rural_def))
rucc_all <- bind_rows(
rucc_1974,
rucc_1983,
rucc_1993,
rucc_2003,
rucc_2013,
rucc_2023
) %>%
left_join(
.,
cori.utils::county_state_crosswalk,
by = c("geoid" = "geoid_co")
) %>%
select(-rural_def) %>%
pivot_wider(
names_from = "year",
names_prefix = "rucc_",
values_from = "is_rural"
) %>%
mutate(
rural_to_nonrural = ifelse(
rucc_1974 == "Rural" & rucc_1983 == "Nonrural",
1983,
ifelse(
rucc_1974 == "Rural" & rucc_1993 == "Nonrural",
1993,
ifelse(
rucc_1974 == "Rural" & rucc_2003 == "Nonrural",
2003,
ifelse(
rucc_1974 == "Rural" & rucc_2013 == "Nonrural",
2013,
ifelse(
rucc_1974 == "Rural" & rucc_2023 == "Nonrural",
2023,
NA
)
)
)
)
),
nonrural_to_rural = ifelse(
rucc_1974 == "Nonrural" & rucc_1983 == "Rural",
1983,
ifelse(
rucc_1974 == "Nonrural" & rucc_1993 == "Rural",
1993,
ifelse(
rucc_1974 == "Nonrural" & rucc_2003 == "Rural",
2003,
ifelse(
rucc_1974 == "Nonrural" & rucc_2013 == "Rural",
2013,
ifelse(
rucc_1974 == "Nonrural" & rucc_2023 == "Rural",
2023,
NA
)
)
)
)
)
)
readr::write_csv(rucc_all, here("posts/14_nonmetro_to_metro/data/rucc_over_time.csv"))
View(rucc_all)
rucc_all %>% filter(rural_to_nonrural == 2023) %>% pull(geoid) %>% unique()
