rank = `1=Low  7=High`,
geoid = `FIPS Code`
)
ers_typology <- readxl::read_excel(
here("posts/14_nonmetro_to_metro/data/erscountytypology2025edition.xlsx"),
sheet = "2025 ERS County Typology Codes"
)
nat_amenity_scale <- readxl::read_excel(
here("posts/14_nonmetro_to_metro/data/natamenf_1_.xls"),
skip = 104
) %>%
rename(
rank = `1=Low  7=High`,
geoid = `FIPS Code`
)
ers_typology <- readxl::read_excel(
here("posts/14_nonmetro_to_metro/data/erscountytypology2025edition.xlsx"),
sheet = "2025 ERS County Typology Codes"
)
check <- left_join(
rucc_all,
nat_amenity_scale,
by = "geoid"
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
group_by(category) %>%
summarise(
avg_rank = mean(rank, na.rm = TRUE),
county = n_distinct(geoid)
)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
group_by(category, Attribute) %>%
summarise(
avg = mean(Value, na.rm = TRUE),
count = n_distinct(geoid)
)
View(ers_typology)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
group_by(category, tidyr::starts_with("High")) %>%
summarise(
avg = mean(Value, na.rm = TRUE),
count = n_distinct(geoid)
)
glimpse(ers_typology)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
)
View(check)
glimpse(ers_typology)
View(ers_typology)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
filter(High_Recreation_2025 != 99) %>%
group_by(category, High_Recreation_2025) %>%
summarise(
val = sum(High_Recreation_2025),
count = n_distinct(geoid)
)
10/43
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
tidyr::pivot_longer(tidyr::starts_with("High"))
View(ers_typology)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
)
View(check)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
tidyr::pivot_longer(tidyr::starts_with("High")
names_to = "typology")
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
tidyr::pivot_longer(
tidyr::starts_with("High"),
names_to = "typology"
)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
tidyr::pivot_longer(
tidyr::starts_with("High"),
names_to = "typology"
) %>%
filter( value != 99)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
tidyr::pivot_longer(
tidyr::starts_with("High"),
names_to = "typology"
) %>%
filter( value != 99) %>%
group_by(category, typology) %>%
summarise(
valye = sum(value),
count = n_distinct(geoid)
)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
tidyr::pivot_longer(
tidyr::starts_with("High"),
names_to = "typology"
) %>%
filter( value != 99) %>%
group_by(category, typology) %>%
summarise(
value = sum(value),
count = n_distinct(geoid),
pct = value / count
)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
# category = ifelse(
#   geoid %in% nonmetro_to_metro_geoids,
#   "Nonmetro to metro 2023",
#   ifelse(
#     geoid %in% rucc_nonmetro_2023,
#     "Nonmetro in 2023",
#     "All other metro in 2023"
#   )
# )
category = ifelse(
!is.na(rural_to_nonrural),
"Rural to nonrural",
ifelse(
rucc_2023 == "Rural",
"Rural",
ifelse(
rucc_2023 == "Nonrural",
"Nonrural",
NA
)
)
)
) %>%
tidyr::pivot_longer(
tidyr::starts_with("High"),
names_to = "typology"
) %>%
filter( value != 99) %>%
group_by(category, typology) %>%
summarise(
value = sum(value),
count = n_distinct(geoid),
pct = value / count
)
check <- left_join(
rucc_all,
ers_typology,
by = c("geoid" = "FIPStxt")
) %>%
mutate(
category = ifelse(
geoid %in% nonmetro_to_metro_geoids,
"Nonmetro to metro 2023",
ifelse(
geoid %in% rucc_nonmetro_2023,
"Nonmetro in 2023",
"All other metro in 2023"
)
)
# category = ifelse(
#   !is.na(rural_to_nonrural),
#   "Rural to nonrural",
#   ifelse(
#     rucc_2023 == "Rural",
#     "Rural",
#     ifelse(
#       rucc_2023 == "Nonrural",
#       "Nonrural",
#       NA
#     )
#   )
# )
) %>%
tidyr::pivot_longer(
tidyr::starts_with("High"),
names_to = "typology"
) %>%
filter( value != 99) %>%
group_by(category, typology) %>%
summarise(
value = sum(value),
count = n_distinct(geoid),
pct = value / count
)
View(rural_to_nonrural)
nonrural_to_rural <- rucc_all %>% filter(!is.na(nonrural_to_rural))
View(nonrural_to_rural)
